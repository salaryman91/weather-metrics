# .github/workflows/asos.yml
name: asos-feels-kmahub

on:
  schedule:
    - cron: "*/30 * * * *"   # UTC 기준 매 30분 (TZ 상관없이 30분마다 수행)
  workflow_dispatch:

concurrency:
  group: asos-feels
  cancel-in-progress: true

jobs:
  run:
    runs-on: ubuntu-latest
    permissions: { contents: read }
    env:
      TZ: Asia/Seoul

      # Influx
      INFLUX_URL:     ${{ vars.INFLUX_URL }}
      INFLUX_ORG:     ${{ vars.INFLUX_ORG }}
      INFLUX_BUCKET:  ${{ vars.INFLUX_BUCKET }}
      INFLUX_TOKEN:   ${{ secrets.INFLUX_TOKEN }}

      # KMA API
      APIHUB_BASE:    ${{ vars.APIHUB_BASE }}
      APIHUB_KEY:     ${{ secrets.APIHUB_KEY }}

      # 위치/지점
      LOC:            ${{ vars.LOC }}
      ASOS_STN:       ${{ vars.ASOS_STN }}
      NX:             ${{ vars.NX }}
      NY:             ${{ vars.NY }}

      # 임시 디버그가 필요할 때
      # DEBUG_FEELS: "1"

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 20, cache: npm }
      - run: npm ci
      - name: Run feels (HI/WC/AT + actual T)
        run: npx ts-node scripts/asos_feels_to_influx.ts
